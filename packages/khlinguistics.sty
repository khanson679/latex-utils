% khling.sty
% Macros for linguistics
%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{khlinguistics}

\RequirePackage{etoolbox}
\RequirePackage{xspace}
\RequirePackage{xkeyval}

%
% Fonts
%

\RequirePackage{amsmath} % bmatrix, Bmatrix
\RequirePackage[only,llbracket,rrbracket]{stmaryrd} % double brackets
\RequirePackage{pifont} % checkmark and x-mark symbols

%% load amssym only if needed -- other packages may provide these symbols
\@ifundefined{varnothing}{\RequirePackage{amssymb}}{}

%% load just \{l,r,u,d}times from mathdesign
\DeclareFontEncoding{MDA}{}{}
\DeclareFontSubstitution{MDA}{cmr}{m}{n}
\DeclareSymbolFont{mathdesignA}{MDA}{mdput}{m}{n}
\SetSymbolFont{mathdesignA}{bold}{MDA}{mdput}{b}{n}
\DeclareMathSymbol{\ltimes}{\mathbin}{mathdesignA}{"6E}
\DeclareMathSymbol{\rtimes}{\mathbin}{mathdesignA}{"6F}
\DeclareMathSymbol{\utimes}{\mathbin}{mathdesignA}{"5E}
\DeclareMathSymbol{\dtimes}{\mathbin}{mathdesignA}{"5F}

%
% Symbol shortcuts
%

%% text symbols
\newcommand{\emptystr}{$\varepsilon$\xspace}
\newcommand{\zero}{$\varnothing$\xspace}
\newcommand{\gap}[1][1.5em]{\rule{#1}{.5pt}\xspace}
\newcommand{\chkmark}{\ding{51}\xspace}
\newcommand{\xmark}{\ding{55}\xspace}

\newcommand{\lrarrow}{\ensuremath{\leftrightarrow}\xspace}
\newcommand{\larrow}{\ensuremath{\leftarrow}\xspace}
\newcommand{\rarrow}{\ensuremath{\rightarrow}\xspace}

%% math symbols
\renewcommand{\emptyset}{\varnothing}


%
% Brackets
%

%% matched brackets
\newcommand{\setof}[1]{\{#1\}}
\newcommand{\bigset}[2][c]{%
    $\left\{\begin{tabular}[c]{@{\hspace{.1em}}#1@{\hspace{.1em}}}#2\end{tabular}\right\}$}
\newcommand{\tuple}[1]{$\langle$#1$\rangle$}
\newcommand{\anglebr}[1]{$\langle$#1$\rangle$}
\newcommand{\dblsqbr}[1]{$\llbracket$#1$\rrbracket$}

%% Big brackets -- create single column array
%% from a comma-separated list

\newcommand*{\textmatrixline}[1]{\text{#1}\\}

\newcommand*{\bigsqbr}[1]{%
  \(%
    \begin{bmatrix}%
      \forcsvlist{\textmatrixline}{#1}%
    \end{bmatrix}%
  \)%
}

\newcommand*{\bigcurlybr}[1]{%
  \(%
    \begin{Bmatrix}%
      \forcsvlist{\textmatrixline}{#1}%
    \end{Bmatrix}%
  \)%
}


%
% Phonology
%

\newcommand{\ur}[1]{/#1/}
\newcommand{\sr}[1]{[#1]}

%
% Syntax
%

%% syntactic categories
\newcommand{\emptyD}{\zero{}$_{D}$\xspace}
\newcommand{\emptyT}{\zero{}$_{T}$\xspace}
\newcommand{\lv}{\textit{\rmfamily v}\xspace}
\newcommand{\lvb}{\textit{\rmfamily v}$'$\xspace}
\newcommand{\lvp}{\textit{\rmfamily v}P\xspace}
\newcommand{\pred}{\textsc{pred}\xspace}
\newcommand{\appl}{\textsc{appl}\xspace}
\newcommand{\Tpast}{T$_\textsc{past}$\xspace}
\newcommand{\Tpres}{T$_\textsc{pres}$\xspace}

%% PS brackets with optional labels
\newcommand{\psbr}[2][]{$[_{\text{\tiny #1}}$\hspace{.08em}#2\hspace{.08em}$]$}

%% Properly formatted trace with an optional index
\newcommand*{\tr}[1][]{\textit{\rmfamily t}\textsubscript{#1}\xspace}

\newcommand{\del}[1]{\anglebr{#1}}

%
% Semantics
%

\newcommand{\semtype}[1]{\ensuremath{\langle#1\rangle}}
\newcommand{\typeet}{\semtype{e,t}}
\newcommand{\typeeet}{\semtype{e,\semtype{e,t}}}
\newcommand{\typeett}{\semtype{\semtype{e,t},t}}
\newcommand{\typeetet}{\semtype{\semtype{e,t},\semtype{e,t}}}

\newcommand{\denot}[2][]{\dblsqbr{#2}$^{#1}$}

%
% Mathling
%

%% special elements
\newcommand{\ledge}{\ensuremath{\rtimes}}
\newcommand{\redge}{\ensuremath{\ltimes}}
\newcommand{\tedge}{\ensuremath{\dtimes}}
\newcommand{\bedge}{\ensuremath{\utimes}}
\newcommand{\slot}{\ensuremath{\Box}}

%% relations
\newcommand{\scsr}{\triangleleft}
\newcommand{\tscsr}{\scsr_T}
\newcommand{\tprec}{\prec_T}

\newcommand{\idom}{\triangleleft}
\newcommand{\pdom}{\triangleleft^+}
\let\dom\pdom
\newcommand{\rdom}{\triangleleft^*}
\newcommand{\tdom}{\triangleleft_T}

\newcommand{\ilsib}{\prec}
\newcommand{\plsib}{\prec^+}
\let\lsib\plsib
\newcommand{\rlsib}{\prec^*}
\newcommand{\tlsib}{\prec_T}


%% MGs
\newcommand{\mergedot}{$\circ$\xspace}
\newcommand{\movedot}{$\bullet$\xspace}
\newcommand{\mglifont}{\normalfont}
\newcommand{\mgli}[2]{{\mglifont #1 ::\ #2}}
\newcommand{\mgfstr}[1]{{\mglifont #1}}
\newcommand{\mgflist}[1]{$\langle$\mgfstr{#1}$\rangle$}

%\newcommand{\fsel}[1]{#1$^+$}
%\newcommand{\fcat}[1]{#1$^-$}
%\newcommand{\flcr}[1]{#1$^+$}
%\newcommand{\flce}[1]{#1$^-$}

\define@choicekey*{khlinguistics}{mgfeatures}[\val\n]{classic,pmprefix,pmsuper}[pmprefix]{%
    \ifcase\n
        \providecommand{\fsel}[1]{$=$##1}
        \providecommand{\fcat}[1]{##1}
        \providecommand{\flcr}[1]{$+$##1}
        \providecommand{\flce}[1]{$-$##1}
    \or
        \providecommand{\fsel}[1]{$+$##1}
        \providecommand{\fcat}[1]{$-$##1}
        \providecommand{\flcr}[1]{$+$##1}
        \providecommand{\flce}[1]{$-$##1}
    \or
        \providecommand{\fsel}[1]{##1$^+$}
        \providecommand{\fcat}[1]{##1$^-$}
        \providecommand{\flcr}[1]{##1$^+$}
        \providecommand{\flce}[1]{##1$^-$}
    \fi
}
\presetkeys{khlinguistics}{mgfeatures}{}
\ProcessOptionsX<khlinguistics>